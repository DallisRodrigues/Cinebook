<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cinemas | CineBook</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Manrope:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,1,0" />
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Manrope', 'sans-serif'], header: ['Bebas Neue', 'sans-serif'] },
                    colors: { brand: { red: '#E50914', dark: '#0A0A0A', card: '#151515' } }
                }
            }
        }
    </script>
    <style>body { background-color: #0A0A0A; color: white; }</style>
</head>
<body>

    <nav class="fixed top-0 w-full z-50 bg-brand-dark/95 backdrop-blur-md border-b border-white/5">
        <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
            <a href="home.html" class="flex items-center gap-2">
                <span class="material-symbols-rounded text-brand-red text-3xl">arrow_back</span>
                <span class="font-header text-xl tracking-wide">Back to Home</span>
            </a>
            <h1 class="text-lg font-bold">Cinemas in <span id="city-name" class="text-brand-red">Mumbai</span></h1>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-6 pt-24 pb-20">
        <div class="relative mb-8">
            <span class="material-symbols-rounded absolute left-4 top-3 text-gray-500">search</span>
            <input type="text" id="search-input" placeholder="Search for PVR, INOX, Area..." 
                   class="w-full bg-[#1a1a1a] border border-[#333] rounded-lg py-3 pl-12 pr-4 text-sm focus:outline-none focus:border-brand-red transition"
                   onkeyup="filterCinemas()">
        </div>

        <div id="cinema-container" class="space-y-4">
            <div class="text-center py-20 text-gray-500 animate-pulse">Loading Cinemas...</div>
        </div>
    </main>

    <script>
        const API_GATEWAY = "http://localhost:8080";
        const urlParams = new URLSearchParams(window.location.search);
        const CITY_ID = urlParams.get('cityId') || 1;
        const CITY_NAME = urlParams.get('name') || "Mumbai";
        
        let allCinemas = [];

        document.addEventListener("DOMContentLoaded", () => {
            document.getElementById('city-name').innerText = CITY_NAME;
            fetchCinemas();
        });

        async function fetchCinemas() {
            try {
                const res = await fetch(`${API_GATEWAY}/locations/cities/${CITY_ID}/cinemas`);
                allCinemas = await res.json();
                renderCinemas(allCinemas);
            } catch (e) {
                document.getElementById('cinema-container').innerHTML = `<div class="text-red-500 text-center">Failed to load data.</div>`;
            }
        }

        function renderCinemas(cinemas) {
            const container = document.getElementById('cinema-container');
            container.innerHTML = "";

            if(cinemas.length === 0) {
                container.innerHTML = `<div class="text-gray-500 text-center py-10">No cinemas found.</div>`;
                return;
            }

            cinemas.forEach(c => {
                container.innerHTML += `
                    <div class="bg-brand-card p-5 rounded-xl border border-[#222] hover:border-gray-600 transition flex justify-between items-center group">
                        <div>
                            <div class="flex items-center gap-3 mb-1">
                                <span class="material-symbols-rounded text-brand-red">theaters</span>
                                <h3 class="font-bold text-lg group-hover:text-brand-red transition">${c.name}</h3>
                            </div>
                            <p class="text-sm text-gray-400 pl-9">${c.address}</p>
                        </div>
                        <div class="flex gap-3">
                            <span class="px-3 py-1 bg-green-900/20 text-green-500 text-xs font-bold rounded border border-green-900">M-Ticket</span>
                            <span class="px-3 py-1 bg-yellow-900/20 text-yellow-500 text-xs font-bold rounded border border-yellow-900">F&B</span>
                        </div>
                    </div>
                `;
            });
        }

        function filterCinemas() {
            const query = document.getElementById('search-input').value.toLowerCase();
            const filtered = allCinemas.filter(c => c.name.toLowerCase().includes(query) || c.address.toLowerCase().includes(query));
            renderCinemas(filtered);
        }
    </script>
</body>
</html>